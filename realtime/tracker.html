<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Compound Trade Task Tracker</title>
<style>
  :root {
    --bg: #f5f5f5;
    --text: #111;
    --card: #ffffff;
    --accent: #4caf50;
  }
  body.dark {
    --bg: #121212;
    --text: #f5f5f5;
    --card: #1e1e1e;
    --accent: #81c784;
  }
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }
  header {
    position: sticky;
    top: 0;
    background: var(--card);
    padding: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 10;
  }
  h1 {
    margin: 0 0 10px 0;
  }
  .inputs, .buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 10px;
  }
  input, select, button {
    padding: 6px;
    font-size: 14px;
  }
  button {
    cursor: pointer;
  }
  .summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
    gap: 10px;
    margin-bottom: 10px;
  }
  .card {
    background: var(--card);
    padding: 10px;
    border-radius: 6px;
  }
  .progress-container {
    width: 100%;
    background: #ccc;
    border-radius: 5px;
    overflow: hidden;
  }
  .progress-bar {
    height: 10px;
    background: var(--accent);
    width: 0%;
  }
  #taskContainer {
    max-height: 70vh;
    overflow-y: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 6px;
    border-bottom: 1px solid #ccc;
    text-align: center;
  }
  tr.current {
    background: rgba(76,175,80,0.2);
  }
</style>
</head>
<body>
<header>
  <h1>Compound Trade Task Tracker</h1>

  <div class="inputs">
    <input id="capital" type="number" placeholder="Initial Capital" value="300">
    <input id="profit" type="number" placeholder="Profit per Trade (%)" value="3">
    <input id="target" type="number" placeholder="Target Balance" value="20000">
    <input id="tph" type="number" placeholder="Trades per Hour" value="4">
    <input id="hpd" type="number" placeholder="Hours per Day" value="4">
    <select id="mode">
      <option value="total">Generate by Total Trades</option>
      <option value="target">Generate until Target Balance</option>
    </select>
    <input id="totalTrades" type="number" placeholder="Total Trades (if mode=total)" value="100">
  </div>

  <div class="buttons">
    <button onclick="generatePlan()">Generate Plan</button>
    <button onclick="saveState()">Save Progress</button>
    <button onclick="resetPlan()">Reset Plan</button>
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="exportJSON()">Export JSON</button>
    <input type="file" id="importFile" onchange="importJSON(event)">
    <button onclick="jumpToCurrent()">Jump to Current Trade</button>
    <button onclick="markNext()">Mark Next Trade Done</button>
    <button onclick="undoLast()">Undo Last Trade</button>
    <button onclick="toggleDark()">Dark Mode</button>
  </div>

  <div class="summary">
    <div class="card">Current Trade: <span id="currentTrade">0</span></div>
    <div class="card">Completed / Total: <span id="completed">0</span></div>
    <div class="card">Current Balance: $<span id="currentBalance">0</span></div>
    <div class="card">Next Balance: $<span id="nextBalance">0</span></div>
    <div class="card">Remaining to Target: $<span id="remaining">0</span></div>
    <div class="card">Est. Time Remaining: <span id="timeRemaining">0</span></div>
  </div>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</header>

<div id="taskContainer">
  <table>
    <thead>
      <tr>
        <th>Done</th>
        <th>Trade #</th>
        <th>Balance After</th>
        <th>Profit</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="taskTable"></tbody>
  </table>
</div>

<script>
let state = {
  inputs: {},
  trades: []
};

function generatePlan() {
  const capital = parseFloat(capitalInput.value);
  const profit = parseFloat(profitInput.value);
  const target = parseFloat(targetInput.value);
  const tph = parseInt(tphInput.value);
  const hpd = parseInt(hpdInput.value);
  const mode = modeSelect.value;
  const totalTrades = parseInt(totalTradesInput.value);

  let trades = [];
  let balance = capital;
  let tradeCount = 0;

  while (true) {
    tradeCount++;
    let newBalance = balance * (1 + profit / 100);
    trades.push({
      trade: tradeCount,
      balance: newBalance.toFixed(2),
      profit: (newBalance - balance).toFixed(2),
      done: false,
      timestamp: ""
    });
    balance = newBalance;

    if (mode === "total" && tradeCount >= totalTrades) break;
    if (mode === "target" && balance >= target) break;
    if (tradeCount >= 500) break;
  }

  state = {
    inputs: {capital, profit, target, tph, hpd, mode, totalTrades},
    trades
  };

  saveState();
  render();
}

function render() {
  const tbody = document.getElementById("taskTable");
  tbody.innerHTML = "";
  const fragment = document.createDocumentFragment();

  state.trades.forEach((t, i) => {
    const tr = document.createElement("tr");
    if (!t.done && getCurrentTradeIndex() === i) tr.classList.add("current");

    tr.innerHTML = `
      <td><input type="checkbox" ${t.done ? "checked":""} onchange="toggleDone(${i}, this.checked)"></td>
      <td>${t.trade}</td>
      <td>$${t.balance}</td>
      <td>$${t.profit}</td>
      <td>${t.timestamp || ""}</td>
    `;
    fragment.appendChild(tr);
  });

  tbody.appendChild(fragment);
  updateSummary();
}

function toggleDone(index, checked) {
  state.trades[index].done = checked;
  state.trades[index].timestamp = checked ? new Date().toLocaleString() : "";
  saveState();
  render();
}

function updateSummary() {
  const completed = state.trades.filter(t => t.done).length;
  const total = state.trades.length;
  const currentTrade = completed + 1;
  const lastBalance = completed === 0 ? state.inputs.capital : state.trades[completed-1].balance;
  const nextBalance = state.trades[completed] ? state.trades[completed].balance : lastBalance;
  const remaining = Math.max(0, state.inputs.target - lastBalance);
  const tradesLeft = total - completed;
  const hoursLeft = tradesLeft / state.inputs.tph;
  const daysLeft = hoursLeft / state.inputs.hpd;

  document.getElementById("currentTrade").innerText = currentTrade;
  document.getElementById("completed").innerText = `${completed} / ${total}`;
  document.getElementById("currentBalance").innerText = Number(lastBalance).toFixed(2);
  document.getElementById("nextBalance").innerText = Number(nextBalance).toFixed(2);
  document.getElementById("remaining").innerText = remaining.toFixed(2);
  document.getElementById("timeRemaining").innerText = `${daysLeft.toFixed(2)} days`;

  const percent = (completed / total) * 100;
  document.getElementById("progressBar").style.width = percent + "%";
}

function getCurrentTradeIndex() {
  return state.trades.findIndex(t => !t.done);
}

function jumpToCurrent() {
  const index = getCurrentTradeIndex();
  const rows = document.querySelectorAll("#taskTable tr");
  if (rows[index]) rows[index].scrollIntoView({behavior:"smooth"});
}

function markNext() {
  const index = getCurrentTradeIndex();
  if (index >= 0) toggleDone(index, true);
}

function undoLast() {
  const doneTrades = state.trades.map((t,i)=>({t,i})).filter(x=>x.t.done);
  if (doneTrades.length === 0) return;
  const last = doneTrades[doneTrades.length-1].i;
  toggleDone(last, false);
}

function saveState() {
  localStorage.setItem("tradeTrackerState", JSON.stringify(state));
}

function loadState() {
  const saved = localStorage.getItem("tradeTrackerState");
  if (saved) {
    state = JSON.parse(saved);
    render();
  }
}

function resetPlan() {
  if (!confirm("Clear all progress?")) return;
  localStorage.removeItem("tradeTrackerState");
  state = {inputs:{}, trades:[]};
  render();
}

function exportCSV() {
  let csv = "tradeNumber,done,balanceAfter,profitAmount,timestamp\n";
  state.trades.forEach(t=>{
    csv += `${t.trade},${t.done},${t.balance},${t.profit},${t.timestamp}\n`;
  });
  downloadFile(csv, "trades.csv", "text/csv");
}

function exportJSON() {
  downloadFile(JSON.stringify(state, null, 2), "trades.json", "application/json");
}

function importJSON(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    state = JSON.parse(reader.result);
    saveState();
    render();
  };
  reader.readAsText(file);
}

function downloadFile(content, filename, type) {
  const blob = new Blob([content], {type});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

const capitalInput = document.getElementById("capital");
const profitInput = document.getElementById("profit");
const targetInput = document.getElementById("target");
const tphInput = document.getElementById("tph");
const hpdInput = document.getElementById("hpd");
const modeSelect = document.getElementById("mode");
const totalTradesInput = document.getElementById("totalTrades");

loadState();
</script>
</body>
</html>